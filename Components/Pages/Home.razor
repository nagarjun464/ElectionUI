@page "/home"
@using Blazored.Toast.Services
@rendermode InteractiveServer
@using Electionapp.UI.Models;
@inject NavigationManager Nav
@inject IJSRuntime JS

@if (!string.IsNullOrEmpty(successMessage))
{
    <div class="alert alert-success text-center mt-3" role="alert">
        @successMessage
    </div>
}

<div class="hero">
    <div class="overlay">
        <h1>Welcome to Election Admin</h1>
        <p>Manage elections, candidates, and more.</p>
    </div>
</div>
@code {
    private string? successMessage;

    protected override void OnInitialized()
    {
        var uri = new Uri(Nav.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        string email = query.TryGetValue("email", out var mail) ? mail.ToString() : string.Empty;

        if (!string.IsNullOrEmpty(email) && email.Contains("@"))
        {
            var username = email.Split('@')[0]; 
            successMessage = $"👋 Hey {username}, login successful!";
        }
        else
        {
            successMessage = "✅ Login was successful!";
        }
        
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !string.IsNullOrEmpty(successMessage))
        {
            await Task.Delay(3000); 
            successMessage = null;  
            StateHasChanged();      
        }
    }
}